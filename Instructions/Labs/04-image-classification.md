---
lab:
  title: تصنيف الصور
  description: استخدم خدمة Azure AI Custom Vision لتدريب نموذج لتصنيف الصور.
---

# تصنيف الصور

تمكنك خدمة **Azure AI Custom Vision** من إنشاء نماذج رؤية الكمبيوتر المدربة على صورك الخاصة. يمكنك استخدامه لتدريب *تصنيف الصور* ونماذج *الكشف عن الكائنات*؛ والتي يمكنك بعد ذلك نشرها واستهلاكها من التطبيقات.

في هذا التمرين، ستستخدم خدمة Custom Vision لتدريب نموذج تصنيف الصور الذي يمكنه اكتشاف ثلاث فئات من الفاكهة (التفاح والموز والبرتقال).

يستند هذا التمرين إلى عدة تطوير البرامج (SDK) الخاصة بـ Azure Custom Vision للغة Python، لكن يمكنك تطوير تطبيقات الرؤية الحاسوبية باستخدام عِدد تطوير برامج (SDK) خاصة بلغات متعددة، منها:

* [Azure Custom Vision للغة JavaScript (التدريب)](https://www.npmjs.com/package/@azure/cognitiveservices-customvision-training)
* [Azure Custom Vision للغة JavaScript (التنبؤ)](https://www.npmjs.com/package/@azure/cognitiveservices-customvision-prediction)
* [Azure Custom Vision للغة Microsoft .NET (التدريب)](https://www.nuget.org/packages/Microsoft.Azure.CognitiveServices.Vision.CustomVision.Training/)
* [Azure Custom Vision للغة Microsoft .NET (التنبؤ)](https://www.nuget.org/packages/Microsoft.Azure.CognitiveServices.Vision.CustomVision.Prediction/)
* [Azure Custom Vision للغة Java (التدريب)](https://search.maven.org/artifact/com.azure/azure-cognitiveservices-customvision-training/1.1.0-preview.2/jar)
* [Azure Custom Vision للغة Java (التنبؤ)](https://search.maven.org/artifact/com.azure/azure-cognitiveservices-customvision-prediction/1.1.0-preview.2/jar)

يستغرق هذا التدريب حوالي **45** دقيقة.

## إنشاء موارد الرؤية المخصصة

قبل أن تتمكن من تدريب نموذج، ستحتاج إلى موارد Azure *للتدريب* و*التنبؤ*. يمكنك إنشاء موارد **Custom Vision** لكل مهمة، أو إنشاء مورد واحد لاستخدامه في المهمتين معًا. في هذا التمرين، ستنشئ موارد **Custom Vision** للتدريب والتنبؤ.

1. افتح [مدخل Microsoft Azure](https://portal.azure.com) عبر `https://portal.azure.com`، وسجِّل الدخول باستخدام بيانات اعتماد Azure الخاصة بك. أغلِق أي رسائل ترحيب أو تلميحات قد تظهر.
1. حدد **Create a resource.**
1. في شريط البحث، ابحث عن `Custom Vision`، وحدد **Custom Vision**، وأنشئ المورد باستخدام الإعدادات التالية:
    - **إنشاء خيارات**: كلاهما
    - **Subscription**: *اشتراكك في Azure*
    - **Resource group**: *إنشاء مجموعة موارد أو تحديدها*
    - **المنطقة**: *اختر أي منطقة متوفرة*
    - **الاسم**: *اسم صالح لمورد Custom Vision الخاص بك*
    - **مستوى أسعار التدريب:** F0
    - **مستوى أسعار التنبؤ**: F0

1. أنشئ المورد وانتظر حتى يكتمل التوزيع، ثم اعرض تفاصيل التوزيع. لاحظ أنه تم توفير موردين لـ Custom Vision: أحدهما للتدريب والآخر للتنبؤ.

    > **ملاحظة**: لكل مورد * نقطة نهاية *و*مفاتيح*خاصة به، والتي تستخدم لإدارة الوصول من التعليمات البرمجية الخاصة بك. لتدريب نموذج تصنيف الصور، يجب أن تستخدم التعليمات البرمجية لديك مورد * التدريب* (بنقطة النهاية والمفتاح الخاص بها)؛ ولاستخدام النموذج المدرب للتنبؤ بفئات الصور، يجب أن تستخدم التعليمات البرمجية لديك مورد* التنبؤ* (باستخدام نقطة النهاية والمفتاح الخاص بها).

1. بعد توزيع الموارد، انتقل إلى مجموعة الموارد لعرضها. يجب أن ترى موردَين لـ custom vision، أحدهما يحمل اللاحقة ***Prediction-***.

## إنشاء مشروع Custom Vision في مدخل Custom Vision

لتدريب نموذج تصنيف الصورة، تحتاج إلى إنشاء مشروع رؤية معدلة بناءً على مورد التدريب الخاص بك. للقيام بذلك، ستستخدم مدخل Custom Vision.

1. افتح علامة تبويب جديدة في المتصفح (مع ترك علامة تبويب مدخل Microsoft Azure مفتوحة، إذ ستعود إليها لاحقًا).
1. في علامة التبويب الجديدة في المتصفح، افتح [مدخل Custom Vision](https://customvision.ai) عبر `https://customvision.ai`. إذا طُلب منك ذلك، فسجِّل الدخول باستخدام بيانات اعتماد Azure الخاصة بك ووافق على شروط الخدمة.
1. في مدخل Custom Vision، أنشئ مشروعًا جديدًا بالإعدادات التالية:
    - **الاسم:** `Classify Fruit`
    - **الوصف**: `Image classification for fruit`
    - **المورد**: *مورد Custom Vision الخاص بك*
    - **أنواع المشاريع**: التصنيف
    - **أنواع التصنيف**: متعدد الفئات (علامة واحدة لكل صورة)
    - **المَجالات**: الغذاء

### تحميل الصور ووضع علامات عليها

1. في علامة تبويب جديدة في المتصفح، نزِّل [صور التدريب](https://github.com/MicrosoftLearning/mslearn-ai-vision/raw/main/Labfiles/image-classification/training-images.zip) من `https://github.com/MicrosoftLearning/mslearn-ai-vision/raw/main/Labfiles/image-classification/training-images.zip` واستخرج المجلد المضغوط لعرض محتوياته. يحتوي هذا المجلد على مجلدات فرعية من صور التفاح والموز والبرتقال.
1. في مدخل Custom Vision، وفي مشروع تصنيف الصور الخاص بك، انقر على **إضافة صور**، وحدد جميع الملفات في مجلد **training-images/apple** الذي نزَّلته واستخرجته مسبقًا. بعد ذلك، حمِّل ملفات الصور، مع تحديد العلامة `apple`، على النحو التالي:

    ![لقطة شاشة لتحميل تفاحة باستخدام علامة تفاحة.](../media/upload_apples.jpg)

1. استخدم أيقونة شريط الأدوات **إضافة صور** (**[+]**) لتكرار الخطوة السابقة لتحميل الصور في المجلد **banana** باستخدام العلامة `banana`، والصور في المجلد **orange** باستخدام العلامة `orange`.
1. استكشف الصور التي قمت بتحميلها في مشروع Custom Vision - يجب أن يكون هناك 15 صورة لكل فصل، على النحو التالي:

    ![صور مميزة للفاكهة - 15 تفاحة و 15 موزة و 15 برتقالة](../media/fruit.jpg)

### تدريب نموذج

1. في مشروع Custom Vision، فوق الصور، انقر على **تدريب** (&#9881;<sub>&#9881;</sub>) لتدريب نموذج تصنيف باستخدام الصور ذات العلامات. حدد خيار **"تدريب سريع"**، ثم انتظر حتى يكتمل تكرار التدريب (قد يستغرق ذلك دقيقة أو نحو ذلك).
1. عند تدريب تكرار النموذج، راجع مقاييس الأداء *الدقة**والاستدعاء*و*AP* - تقيس هذه دقة التنبؤ لنموذج التصنيف، ويجب أن تكون جميعها عالية.

    ![لقطة شاشة لمقاييس النموذج.](../media/custom-vision-metrics.png)

> **ملاحظة**: تستند مقاييس الأداء إلى حد احتمال 50% لكل تنبؤ (بمعنى آخر، إذا كان النموذج يحسب احتمالاً بنسبة 50% أو أعلى أن تكون الصورة من فئة معينة، فسيتم التنبؤ بهذه الفئة). يمكنك ضبط هذا في أعلى يسار الصفحة.

### اختبار النموذج

1. فوق مقاييس الأداء، انقر فوق **اختبار سريع**.
1. في المربع **عنوان URL للصورة**، اكتب `https://aka.ms/test-apple` وأنقر فوق زر *صورة الاختبار السريع (➔)*.
1. اعرض التوقعات التي يعرضها نموذجك - يجب أن تكون درجة احتمالية *تفاحة* أعلى، كما يلي:

    ![لقطة شاشة لصورة مع التنبؤ بفئة "تفاح".](../media/test-apple.jpg)

1. جرِّب اختبار الصور التالية:
    - `https://aka.ms/test-banana`
    - `https://aka.ms/test-orange`

1. أغلق نافذة **اختبار سريع**.

### عرض إعدادات المشروع

تم تعيين معرف فريد للمشروع الذي قمت بإنشائه، والذي ستحتاج إلى تحديده في أي تعليمة برمجية تتفاعل معه.

1. انقر فوق أيقونة *الإعدادات* (&#9881;) في أعلى يمين صفحة **الأداء** لعرض إعدادات المشروع.
1. ضمن **عام** (على اليسار)، لاحظ **معرف المشروع** لذي يعرف هذا المشروع بشكل فريد.
1. على اليمين، ضمن **الموارد** لاحظ أنه يتم عرض المفتاح ونقطة النهاية. هذه هي تفاصيل مورد * التدريب* (يمكنك أيضًا الحصول على هذه المعلومات عن طريق عرض المورد في مدخل Microsoft Azure).

## استخدام واجهة برمجة تطبيقات *التدريب*

يوفر مدخل Custom Vision واجهة مستخدم ملائمة يمكنك استخدامها لتحميل الصور ووضع علامات عليها وتدريب النماذج. ومع ذلك، في بعض السيناريوهات قد ترغب في أتمتة تدريب النموذج باستخدام واجهة برمجة تطبيقات تدريب Custom Vision.

### إعداد تكوين التطبيق

1. عُد إلى علامة تبويب المتصفح التي تحتوي على مدخل Microsoft Azure (مع ترك علامة تبويب مدخل Custom Vision مفتوحة، إذ ستعود إليها لاحقًا).
1. في مدخل Microsoft Azure، استخدم الزر **[\>_]** الموجود على يمين شريط البحث في أعلى الصفحة لإنشاء جلسة جديدة من Cloud Shell في مدخل Microsoft Azure، وحدد بيئة ***PowerShell*** دون مساحة تخزين في اشتراكك.

    يوفّر Cloud Shell واجهة سطر الأوامر في الجزء الموجود في أسفل بوابة Azure.

    > **ملاحظة**: إذا كنت قد أنشأت مسبقًا Cloud Shell يستخدم بيئة *معالج Bash*، فبدّل إلى ***PowerShell***.

    > **ملاحظة**: إذا طلب منك المدخل تحديد مساحة تخزين للاحتفاظ بملفاتك بشكل دائم، فاختَر **لا يلزم حساب تخزين**، وحدّد الاشتراك الذي تستخدمه ثم اضغط على **تطبيق**.

1. في شريط أدوات Cloud Shell، في قائمة **الإعدادات**، حدد **الانتقال إلى الإصدار الكلاسيكي** (هذا مطلوب لاستخدام محرر التعليمات البرمجية).

    **<font color="red">تأكد من التبديل إلى الإصدار الكلاسيكي من cloud shell قبل المتابعة.</font>**

1. غيِّر حجم جزء cloud shell لعرض مساحة أكبر منه.

    > **تلميح**" يمكنك تغيير حجم الجزء عن طريق سحب الحد العلوي. يمكنك أيضًا استخدام زرَّي التصغير والتكبير للتبديل بين cloud shell والواجهة الرئيسية للمدخل.

1. في جزء Cloud Shell، أدخل الأوامر التالية لنسخ مخزن بيانات GitHub الخاص الذي يحتوي على ملفات التعليمات البرمجية لهذا التدريب (اكتب الأمر أو انسخه إلى الحافظة ثم انقر بزر الماوس الأيمن في سطر الأوامر والصقه كنص عادي):

    ```
    rm -r mslearn-ai-vision -f
    git clone https://github.com/MicrosoftLearning/mslearn-ai-vision
    ```

    > **تلميح**: عند لصق الأوامر في CloudShell، قد يشغل الإخراج مساحة كبيرة من ذاكرة التخزين المؤقت للشاشة. يمكنك مسح الشاشة عن طريق إدخال الأمر `cls` لتسهيل التركيز على كل مهمة.

1. بعد نسخ المستودع، استخدم الأمر التالي للانتقال إلى ملفات التعليمات البرمجية للتطبيق:

    ```
   cd mslearn-ai-vision/Labfiles/image-classification/python/train-classifier
   ls -a -l
    ```

    يحتوي المجلد على تكوين التطبيق وملفات التعليمات البرمجية له. كما يتضمن المجلد الفرعي **more-training-images/**، والذي يحتوي على بعض ملفات الصور التي ستستخدمها لإجراء تدريب إضافي لنموذجك.

1. ثبِّت حزمة عدة تطوير البرامج (SDK) الخاصة بـ Azure AI Custom Vision للتدريب وأي حزم أخرى مطلوبة بتشغيل الأوامر التالية:

    ```
   python -m venv labenv
   ./labenv/bin/Activate.ps1
   pip install -r requirements.txt azure-cognitiveservices-vision-customvision
    ```

1. أدخِل الأمر التالي لتحرير ملف التكوين الخاص بتطبيقك:

    ```
   code .env
    ```

    يتم فتح الملف في محرر التعليمات البرمجية.

1. في ملف التعليمات البرمجية، حدِّث قيم التكوين التي يحتوي عليها لتعكس **نقطة النهاية** و**مفتاح** مصادقة لمورد *تدريب* Custom Vision الخاص بك، بالإضافة إلى **معرّف المشروع** لمشروع custom vision الذي أنشأته مسبقًا.
1. بعد استبدال العناصر النائبة في محرر التعليمات البرمجية، استخدم الأمر **CTRL+S** لحفظ التغييرات ثم استخدم الأمر **CTRL+Q** لإغلاق محرر التعليمات البرمجية مع إبقاء سطر أوامر Cloud Shell مفتوحًا.

### كتابة التعليمات البرمجية لتنفيذ تدريب النموذج

1. في سطر أوامر cloud shell، أدخِل الأمر التالي لفتح ملف التعليمات البرمجية لتطبيق العميل:

    ```
   code train-classifier.py
    ```

1. لاحظ التفاصيل التالية في ملف التعليمات البرمجية:
    - تم استيراد مساحات الأسماء لعدة تطوير البرامج (SDK) الخاصة بـ Azure AI Custom Vision.
    - تسترد الدالة **Main** إعدادات التكوين، وتستخدم المفتاح ونقطة النهاية لإنشاء عميل مصدّق عليه.
    - **CustomVisionTrainingClient**، والذي يُستخدم بعد ذلك مع معرّف المشروع لإنشاء مرجع **مشروع** لمشروعك.
    - تسترد الدالة **Upload_Images** العلامات المعرفة في مشروع Custom Vision ثم تقوم بتحميل ملفات الصور من المجلدات المسماة المقابلة إلى المشروع، مع تعيين معرف العلامة المناسب.
    - تنشئ الدالة **Train_Model** تكراراً تدريبياً جديداً للمشروع وتنتظر اكتمال التدريب.

1. أغلِق محرر التعليمات البرمجية (*CTRL+Q*) وأدخِل الأمر التالي لتشغيل البرنامج:

    ```
   python train-classifier.py
    ```

1. انتظر حتى ينتهي البرنامج. بعد ذلك، عُد إلى علامة تبويب المتصفح التي تحتوي على مدخل Custom Vision، واعرض صفحة **صور التدريب** الخاصة بمشروعك (مع تحديث المتصفح إذا لزم الأمر).
1. تحقق من إضافة بعض الصور ذات العلامات الجديدة إلى المشروع. ثم اعرض صفحة **الأداء** وتحقق من إنشاء تكرار جديد.

## استخدام مُصنِّف الصور في تطبيق عميل

أنت الآن جاهز لنشر نموذجك المُدرَّب واستخدامه في تطبيق عميل.

### نَشر نموذج تصنيف الصور

1. في مدخل Custom Vision، في صفحة **الأداء**، انقر فوق **&#128504; نشر** لنشر النموذج المُدرب بالإعدادات التالية:
    - **اسم النموذج**: `fruit-classifier`
    - **مورد التنبؤ**: *مورد **التنبؤ** الذي أنشأته سابقًا والذي ينتهي بـ "-Prediction" (<u>ليس هو</u> مورد التدريب)*.
1. في الجزء العلوي الأيسر من صفحة **إعدادات المشروع**، انقر فوق أيقونة *معرض المشاريع* (&#128065;) للعودة إلى الصفحة الرئيسية لمدخل Custom Vision، حيث يتم إدراج مشروعك الآن.
1. في الصفحة الرئيسية لمدخل Custom Vision، في أعلى اليمين، انقر فوق أيقونة *الإعدادات * (&#9881;) لعرض إعدادات خدمة Custom Vision الخاصة بك. ثم، ضمن **الموارد**، ابحث عن مورد * التنبؤ *الذي ينتهي بـ "-Prediction" (<u>وليس</u> مورد التدريب) لتحديد قيم ** المفتاح **** ونقطة النهاية الخاصة به **(يمكنك أيضًا الحصول على هذه المعلومات عن طريق عرض المورد في مدخل Microsoft Azure).

### استخدام مصنف الصور من تطبيق عميل

1. عُد إلى علامة تبويب المتصفح التي تحتوي على مدخل Microsoft Azure وجزء cloud shell.
1. في cloud shell، شغِّل الأوامر التالية للانتقال إلى مجلد تطبيق العميل وعرض الملفات التي يتضمنها:

    ```
   cd ../test-classifier
   ls -a -l
    ```

    يحتوي المجلد على تكوين التطبيق وملفات التعليمات البرمجية له. كما يتضمن المجلد الفرعي **test-images/**، والذي يحتوي على بعض ملفات الصور التي ستستخدمها لاختبار النموذج.

1. ثبِّت حزمة عدة تطوير البرامج (SDK) الخاصة بـ Azure AI Custom Vision للتنبؤ وأي حزم أخرى مطلوبة بتشغيل الأوامر التالية:

    ```
   python -m venv labenv
   ./labenv/bin/Activate.ps1
   pip install -r requirements.txt azure-cognitiveservices-vision-customvision
    ```

1. أدخِل الأمر التالي لتحرير ملف التكوين الخاص بتطبيقك:

    ```
   code .env
    ```

    يتم فتح الملف في محرر التعليمات البرمجية.

1. حدِّث قيم التكوين لتعكس **نقطة النهاية** و**المفتاح** لمورد *<u>تنبؤ</u>* Custom Vision الخاص بك، و**معرّف المشروع** لمشروع التصنيف، واسم النموذج المتاح للنشر (ويُفترض أن يكون *fruit-classifier*). احفظ التغييرات (*CTRL+S*) وأغلِق محرر التعليمات البرمجية (*CTRL+Q*).
1. في سطر أوامر cloud shell، أدخِل الأمر التالي لفتح ملف التعليمات البرمجية لتطبيق العميل:

    ```
   code test-classifier.py
    ```

1. راجع التعليمات البرمجية، مع ملاحظة التفاصيل التالية:
    - تم استيراد مساحات الأسماء لعدة تطوير البرامج (SDK) الخاصة بـ Azure AI Custom Vision.
    - تسترد الدالة ** Main** إعدادات التكوين، وتستخدم المفتاح ونقطة النهاية لإنشاء **CustomVisionPredictionClient** مصدّق عليه.
    - يتم استخدام كائن عميل التنبؤ للتنبؤ بفئة لكل صورة في مجلد **test-images**، مع تحديد معرف المشروع واسم النموذج لكل طلب. يتضمن كل توقع احتمالاً لكل فئة ممكنة، ويتم عرض العلامات المتوقعة التي تحتوي على احتمال أكبر من 50% فقط.

1. أغلِق محرر التعليمات البرمجية وأدخِل الأمر التالي لتشغيل البرنامج:

    ```
   python test-classifier.py
    ```

    يرسل البرنامج كل صورة من الصور التالية إلى النموذج لتصنيفها:

    ![صورة تفاحة](../media/IMG_TEST_1.jpg)

    **IMG_TEST_1.jpg**

    <br/><br/>

    ![صورة موزة](../media/IMG_TEST_2.jpg)

    **IMG_TEST_2.jpg**

    <br/><br/>

    ![صورة برتقالة](../media/IMG_TEST_3.jpg)

    **IMG_TEST_3.jpg**

1. عرض التسمية (العلامة) ودرجات الاحتمال لكل تنبؤ.

## تنظيف الموارد

إذا انتهيت من استكشاف Azure AI Custom Vision، فيُستحسن حذف الموارد التي أنشأتها في هذا التمرين لتفادي تحمّل تكاليف غير ضرورية على Azure:

1. افتح مدخل Azure في `https://portal.azure.com`، وفي شريط البحث العلوي، ابحث عن الموارد التي أنشأتها في هذا المختبر.

1. في صفحة المورد، حدد **حذف** واتبع الإرشادات لحذف المورد. بدلاً من ذلك، يمكنك حذف مجموعة الموارد بأكملها لتنظيف جميع الموارد في الوقت نفسه.

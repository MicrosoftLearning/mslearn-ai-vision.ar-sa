---
lab:
  title: إنشاء صور باستخدام الذكاء الاصطناعي
  description: استخدم نموذج DALL-E من OpenAI في Azure AI Foundry لتوليد الصور.
---

# إنشاء صور باستخدام الذكاء الاصطناعي

في هذا التمرين، تستخدم نموذج الذكاء الاصطناعي التوليدي DALL-E من OpenAI لإنشاء صور. يمكنك أيضًا استخدام عدة تطوير البرامج (SDK) الخاصة بـ OpenAI بلغة Python لإنشاء تطبيق بسيط لتوليد الصور بناءً على مطالباتك.

> **ملاحظة**: يستند هذا التدريب إلى برامج SDK قبل الإصدار، والتي قد تخضع للتغيير. عند الضرورة، استخدمنا إصدارات محددة من الحزم؛ والتي قد لا تعكس أحدث الإصدارات المتوفرة. قد تواجه بعض السلوك أو التحذيرات أو الأخطاء غير المتوقعة.

يستند هذا التمرين إلى عدة تطوير البرامج (SDK) الخاصة بـ OpenAI للغة Python، لكن يمكنك تطوير تطبيقات دردشة ذكاء اصطناعي باستخدام عِدد تطوير برامج (SDK) خاصة بلغات متعددة، منها:

* [مشروعات OpenAI لمنصة Microsoft .NET](https://www.nuget.org/packages/OpenAI)
* [مشروعات OpenAI لمنصة JavaScript](https://www.npmjs.com/package/openai)

سيستغرق هذا التدريب حوالي **30** دقيقة.

## فتح مدخل Azure AI Foundry

لنبدأ بتسجيل الدخول إلى مدخل مصنع الذكاء الاصطناعي في Azure.

1. في متصفح الويب، افتح [مدخل Azure AI Foundry](https://ai.azure.com) على `https://ai.azure.com` وسجّل الدخول باستخدام بيانات اعتماد Azure الخاصة بك. أغلق أي تلميحات أو أجزاء التشغيل السريع يتم فتحه عندما تقوم بتسجيل الدخول لأول مرة، وإذا لزم الأمر،استخدم شعار **Azure AI Foundry** في أعلى اليسار للانتقال إلى الصفحة الرئيسية، والتي تبدو مشابهة للصورة التالية (أغلق جزء **المساعدة** إذا كان مفتوحًا):

    ![لقطة شاشة لمدخل Azure AI Foundry.](./media/ai-foundry-home.png)

1. راجع المعلومات الموجودة في الصفحة الرئيسية.

## اختَر نموذجًا لبدء مشروع

يوفر *مشروع* الذكاء الاصطناعي في Azure مساحة عمل تعاونية لتطوير الذكاء الاصطناعي. لنبدأ باختيار النموذج الذي نريد العمل به وإنشاء مشروع لاستخدامه فيه.

> **ملاحظة**: يمكن أن تعتمد مشاريع AI Foundry على مورد *Azure AI Foundry*، والذي يوفر الوصول إلى نماذج الذكاء الاصطناعي (بما في ذلك Azure OpenAI)، وخدمات الذكاء الاصطناعي في Azure، والموارد الأخرى لتطوير وكلاء الذكاء الاصطناعي وحلول الدردشة. بدلًا من ذلك، يمكن أن تعتمد المشاريع على موارد *مركز الذكاء الاصطناعي*؛ والتي تتضمن اتصالات بموارد Azure للتخزين الآمن والحوسبة والأدوات المتخصصة. تُعد المشاريع المستندة إلى Azure AI Foundry رائعة للمطورين الذين يرغبون في إدارة الموارد لتطوير وكيل ذكاء اصطناعي أو تطبيق دردشة. تُعد المشاريع المعتمدة على مركز الذكاء الاصطناعي أكثر ملاءمة لفرق تطوير المؤسسات التي تعمل على حلول الذكاء الاصطناعي المعقدة.

1. في الصفحة الرئيسية، في قسم **استكشاف النماذج والإمكانات**، ابحث عن النموذج `dall-e-3`؛ الذي سنستخدمه في مشروعنا.

1. في نتائج البحث، حدّد نموذج **dall-e-3** لعرض تفاصيله، ثم في أعلى صفحة النموذج، حدّد **استخدام هذا النموذج**.

1. عند مطالبتك بإنشاء مشروع، أدخل اسمًا صالحًا لمشروعك ووسّع **الخيارات المتقدمة**.

1. حدد **تخصيص** وحدد الإعدادات التالية لمركزك:
    - **مورد Azure AI Foundry**: *اسم صالح لمورد Azure AI Foundry الخاص بك*
    - **Subscription**: *اشتراكك في Azure*
    - **Resource group**: *إنشاء مجموعة موارد أو تحديدها*
    - **المنطقة**: *حدد أيًّا من **ميزات AI Foundry الموصى بها***\*

    > \*تخضع بعض موارد الذكاء الاصطناعي في Azure لحصص النموذج الإقليمية. في حالة تجاوز مساحة القرص المتوفرة لاحقًا في التدريب، هناك احتمال أن تحتاج إلى إنشاء مورد آخر في منطقة مختلفة.

1. حدّد **إنشاء** وانتظر حتى يتم إنشاء مشروعك، بما في ذلك توزيع نموذج dall-e-3 الذي حددته.

    > ملاحظة: بناءً على اختيارك للنموذج، قد تتلقى مطالبات إضافية في أثناء عملية إنشاء المشروع. يُرجى قبول الشروط وإنهاء عملية التوزيع.

1. عند إنشاء مشروعك، سيظهر النموذج الخاص بك في صفحة **النماذج + نقاط النهاية**.

## اختبر النموذج في مساحة التجربة

قبل إنشاء تطبيق عميل، دعنا نختبر نموذج DALL-E في مساحة التجربة.

1. حدّد **مساحات الاختبار**، ثم **مساحات اختبار الصور**.

1. تأكد من تحديد نشر نموذج DALL-E. بعد ذلك، في المربع الموجود بالقرب من أسفل الصفحة، أدخِل مطالبة مثل `Create an image of an robot eating spaghetti` ثم حدّد **إنشاء**.

1. راجع الصورة الناتجة في مساحة التجربة:

    ![لقطة شاشة لمساحة تجربة الصور مع صورة تم إنشاؤها.](../media/images-playground.png)

1. أدخل مطالبة متابعة، مثل `Show the robot in a restaurant` وراجع الصورة الناتجة.

1. استمر في الاختبار باستخدام مطالبات جديدة لتحسين الصورة حتى تصبح راضيًا عنها. 

1. اضغط على زرّ **\</\> عرض التعليمات البرمجية** وتأكد من أنك في علامة تبويب **مصادقة Entra ID**. بعد ذلك، سجّل المعلومات التالية لاستخدامها لاحقًا في التمرين. يُرجى ملاحظة أن القيم المذكورة هي نماذج فقط، تأكد من تسجيل المعلومات الخاصة بتوزيع مشروعك.

    * نقطة نهاية OpenAI: *https://dall-e-aus-resource.cognitiveservices.azure.com/*
    * إصدار واجهة برمجة تطبيقات OpenAI: *2024-04-01-preview*
    * اسم التوزيع (النموذج): *dall-e-3*

## أنشئ تطبيق عميل

يبدو أن النموذج يعمل في مساحة التجربة. يمكنك الآن استخدام عدة تطوير البرامج (SDK) الخاصة بـ OpenAI لاستخدامها في تطبيق عميل.

### إعداد تكوين التطبيق

1. افتح علامة تبويب جديدة للمتصفح (مع إبقاء مدخل مصنع الذكاء الاصطناعي في Azure مفتوحًا في علامة التبويب الموجودة). بعد ذلك في علامة التبويب الجديدة، انتقل إلى [بوابة Azure](https://portal.azure.com) على `https://portal.azure.com`؛ وسجّل الدخول باستخدام بيانات اعتماد Azure الخاصة بك إذا طُلب منك ذلك.

1. استخدم الزر **[\>_]** الموجود على يمين شريط البحث أعلى الصفحة لإنشاء Cloud Shell جديد في بوابة Azure، وتحديد بيئة ***PowerShell***. يوفّر Cloud Shell واجهة سطر أوامر في جزء أسفل بوابة Azure.

    > **ملاحظة**: إذا كنت قد أنشأت مسبقًا Cloud Shell يستخدم بيئة *معالج Bash*، فبدّل إلى ***PowerShell***.

    > **ملاحظة**: إذا طلب منك المدخل تحديد مساحة تخزين للاحتفاظ بملفاتك بشكل دائم، فاختَر **لا يلزم حساب تخزين**، وحدّد الاشتراك الذي تستخدمه ثم اضغط على **تطبيق**.

1. في شريط أدوات Cloud Shell، في قائمة **الإعدادات**، حدد **الانتقال إلى الإصدار الكلاسيكي** (هذا مطلوب لاستخدام محرر التعليمات البرمجية).

    **<font color="red">تأكد من التبديل إلى الإصدار الكلاسيكي من cloud shell قبل المتابعة.</font>**

1. في جزء Cloud Shell، أدخل الأوامر التالية لنسخ مخزن بيانات GitHub الخاص الذي يحتوي على ملفات التعليمات البرمجية لهذا التدريب (اكتب الأمر أو انسخه إلى الحافظة ثم انقر بزر الماوس الأيمن في سطر الأوامر والصقه كنص عادي):

    ```
    rm -r mslearn-ai-vision -f
    git clone https://github.com/MicrosoftLearning/mslearn-ai-vision
    ```

    > **تلميح**: عند لصق الأوامر في CloudShell، قد يشغل الإخراج مساحة كبيرة من ذاكرة التخزين المؤقت للشاشة. يمكنك مسح الشاشة عن طريق إدخال الأمر `cls` لتسهيل التركيز على كل مهمة.

1. بعد استنساخ مخزن بيانات خاصة، انتقل إلى المجلد الذي يحتوي على ملفات التعليمات البرمجية لتطبيق الدردشة:  

    ```
   cd mslearn-ai-vision/Labfiles/dalle-client/python
    ```

1. في جزء سطر أوامر Cloud Shell، أدخل الأمر التالي لتثبيت المكتبات التي ستستخدمها:

    ```
   python -m venv labenv
   ./labenv/bin/Activate.ps1
   pip install -r requirements.txt azure-identity openai requests
    ```

1. أدخل الأمر التالي لتحرير ملف التكوين الذي تم توفيره:

    ```
   code .env
    ```

    يتم فتح الملف في محرر التعليمات البرمجية.

1. استبدل القيم الافتراضية **your_endpoint**، و**your_model_deployment**، و**your_api_version** بالقيم التي سجلتها من **مساحة اختبار الصور**.

1. بعد استبدال العناصر النائبة، استخدم الأمر **CTRL+S** لحفظ التغييرات ثم استخدم الأمر **CTRL+Q** لإغلاق محرر التعليمات البرمجية مع إبقاء سطر أوامر Cloud Shell مفتوحWا.

### اكتب التعليمة البرمجية للاتصال بمشروعك والدردشة مع نموذجك

> **تلميح**: عند إضافة التعليمات البرمجية، تأكد من الحفاظ على المسافة البادئة الصحيحة.

1. أدخل الأمر التالي لتحرير ملف التعليمات البرمجية الذي تم توفيره:

    ```
   code dalle-client.py
    ```

1. في ملف التعليمات البرمجية، لاحظ العبارات الموجودة في أعلى الملف والتي تمت إضافتها لاستيراد مساحات الأسماء (Namespaces) الضرورية لـ (SDK). ثم تحت التعليق **إضافة المراجع**، أضف التعليمة البرمجية التالية للإشارة إلى مساحات الأسماء (Namespaces) في المكتبات التي قمت بتثبيتها مسبقًا:

    ```python
   # Add references
   from dotenv import load_dotenv
   from azure.identity import DefaultAzureCredential, get_bearer_token_provider
   from openai import AzureOpenAI
   import requests
    ```

1. في الدالة **Main**، ضمن تعليق **Get configuration settings**، يُرجى ملاحظة أن التعليمات البرمجية تقوم بتحميل قيم نقطة النهاية، وإصدار واجهة برمجة التطبيقات، واسم توزيع النموذج التي قمت بتعريفها في ملف التكوين.

1. ضمن تعليق **Initialize the client**، أضِف التعليمات البرمجية التالية للاتصال بالنموذج الخاص بك باستخدام بيانات اعتماد Azure التي قمت بتسجيل الدخول بها حاليًا:

    ```python
   # Initialize the client
   token_provider = get_bearer_token_provider(
       DefaultAzureCredential(exclude_environment_credential=True,
           exclude_managed_identity_credential=True), 
       "https://cognitiveservices.azure.com/.default"
   )
    
   client = AzureOpenAI(
       api_version=api_version,
       azure_endpoint=endpoint,
       azure_ad_token_provider=token_provider
   )
    ```

1. لاحظ أن التعليمات البرمجية تتضمن تكرار حلقي للسماح للمستخدم بإدخال مطالبة حتى يدخل "إنهاء". ثم في قسم التكرار، تحت التعليق **إنشاء صورة**، أضف التعليمات البرمجية التالية لإرسال المطالبة واسترجاع عنوان URL للصورة التي تم إنشاؤها من النموذج:

    **Python**

    ```python
   # Generate an image
   result = client.images.generate(
        model=model_deployment,
        prompt=input_text,
        n=1
    )

   json_response = json.loads(result.model_dump_json())
   image_url = json_response["data"][0]["url"] 
    ```

1. لاحظ أن التعليمات البرمجية في الجزء المتبقي من الدالة **main** تمرر عنوان URL للصورة واسم ملف إلى دالة متوفرة، تنزل الصورة التي تم إنشاؤها وحفظها كملف png.

1. استخدم الأمر **CTRL+S** لحفظ التغييرات التي أجريتها على ملف التعليمات البرمجية، ثم استخدم الأمر **CTRL+Q** لإغلاق محرر التعليمات البرمجية مع إبقاء سطر أوامر Cloud Shell مفتوحًا.

### شغّل تطبيق العميل

1. في جزء سطر أوامر Cloud Shell، أدخل الأمر التالي لتسجيل الدخول إلى Azure.

    ```
   az login
    ```

    **<font color="red">يجب عليك تسجيل الدخول إلى Azure - حتى لو تم بالفعل مصادقة جلسة Cloud Shell.</font>**

    > **ملاحظة**: في معظم السيناريوهات، سيكون استخدام *az login* كافيًا. ومع ذلك، إذا كان لديك اشتراكات لدى مستأجرين متعددين، فقد تحتاج إلى تحديد المستأجر باستخدام المعلمة *--tenant*. راجع [تسجيل الدخول إلى Azure بشكل تفاعلي باستخدام Azure CLI](https://learn.microsoft.com/cli/azure/authenticate-azure-cli-interactively) للحصول على التفاصيل.

1. عند مطالبتك بذلك، اتبع الإرشادات لفتح صفحة تسجيل الدخول في علامة تبويب جديدة وأدخل رمز المصادقة المقدم وبيانات اعتماد Azure الخاصة بك. ثم أكمل عملية تسجيل الدخول في سطر الأوامر، وحدد الاشتراك الذي يحتوي على مركز Azure AI Foundry الخاص بك إذا طُلب منك ذلك.

1. في جزء سطر أوامر Cloud Shell، أدخل الأمر التالي لتشغيل التطبيق:

    ```
   python dalle-client.py
    ```

1. عند المطالبة، أدخل طلبًا لإنشاء صورة، مثل `Create an image of a robot eating pizza`. بعد لحظات، من المفترض أن يؤكد التطبيق أنه تم حفظ الصورة.

1. جرّب المزيد من المطالبات. عند الانتهاء، أدخل `quit` للخروج من البرنامج.

    > **ملاحظة**: في هذا التطبيق البسيط، لم ننفّذ منطق للاحتفاظ بسجل المحادثة؛ لذلك سيعامل النموذج كل مطالبة على أنها طلب جديد دون أي سياق للمطالبة السابقة.

1. لتنزيل وعرض الصور التي تم إنشاؤها بواسطة تطبيقك، استخدم أمر **download** في cloud shell - مع تحديد ملف .png الذي تم إنشاؤه:

    ```
   download ./images/image_1.png
    ```

    ينشئ أمر التنزيل رابطًا منبثقًا في أسفل يمين متصفحك، والذي يمكنك تحديده لتنزيل الملف وفتحه.

## الملخص

في هذا التمرين، استخدمت Azure AI Foundry وAzure OpenAI SDK لإنشاء تطبيق عميل يستخدم نموذج DALL-E لإنشاء الصور.

## تنظيف

إذا انتهيت من استكشاف DALL-E، يجب حذف الموارد التي أنشأتها في هذا التمرين لتجنب تكاليف Azure غير الضرورية.

1. ارجع إلى علامة تبويب المتصفح التي تحتوي على بوابة Azure (أو أعد فتح [بوابة Azure](https://portal.azure.com) في `https://portal.azure.com` في علامة تبويب متصفح جديدة) واعرض محتويات مجموعة الموارد التي نشرت فيها الموارد المستخدمة في هذا التدريب.
1. على شريط الأدوات، حدد **حذف مجموعة الموارد**.
1. أدخل اسم مجموعة الموارد وأكّد أنك تريد حذفها.

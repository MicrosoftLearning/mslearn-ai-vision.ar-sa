---
lab:
  title: تطوير تطبيق دردشة يدعم الرؤية
  description: استخدم Azure AI Foundry لبناء تطبيق ذكاء اصطناعي توليدي يدعم إدخال الصور.
---

# تطوير تطبيق دردشة يدعم الرؤية

في هذا التمرين، يمكنك استخدام نموذج الذكاء الاصطناعي التوليدي *Phi-4-multimodal-instruct* لتوليد ردود للمطالبات التي تتضمن صورًا. ستطوّر تطبيقًا يقدّم مساعدات ذكاء اصطناعي تتعلق بالمنتجات الطازجة في متجر بقالة باستخدام Azure AI Foundry وخدمة استدلال نماذج Azure AI.

> **ملاحظة**: يستند هذا التدريب إلى برامج SDK قبل الإصدار، والتي قد تخضع للتغيير. عند الضرورة، استخدمنا إصدارات محددة من الحزم؛ والتي قد لا تعكس أحدث الإصدارات المتوفرة. قد تواجه بعض السلوك أو التحذيرات أو الأخطاء غير المتوقعة.

بينما يستند هذا التمرين إلى SDK الخاصة بمصنع الذكاء الاصطناعي في Azure بلغة Python، يمكنك تطوير تطبيقات دردشة تعتمد على الذكاء الاصطناعي باستخدام عدد SDK الخاصة بلغات متعددة؛ منها:

- [مشاريع الذكاء الاصطناعي في Azure للغة Python](https://pypi.org/project/azure-ai-projects)
- [مشاريع الذكاء الاصطناعي في Azure للغة Microsoft .NET](https://www.nuget.org/packages/Azure.AI.Projects)
- [مشاريع الذكاء الاصطناعي في Azure للغة JavaScript](https://www.npmjs.com/package/@azure/ai-projects)

سيستغرق هذا التدريب حوالي **30** دقيقة.

## فتح مدخل Azure AI Foundry

لنبدأ بتسجيل الدخول إلى مدخل مصنع الذكاء الاصطناعي في Azure.

1. في متصفح الويب، افتح [مدخل Azure AI Foundry](https://ai.azure.com) على `https://ai.azure.com` وسجّل الدخول باستخدام بيانات اعتماد Azure الخاصة بك. أغلق أي تلميحات أو أجزاء التشغيل السريع يتم فتحه عندما تقوم بتسجيل الدخول لأول مرة، وإذا لزم الأمر،استخدم شعار **Azure AI Foundry** في أعلى اليسار للانتقال إلى الصفحة الرئيسية، والتي تبدو مشابهة للصورة التالية (أغلق جزء **المساعدة** إذا كان مفتوحًا):

    ![لقطة شاشة لمدخل Azure AI Foundry.](./media/ai-foundry-home.png)

1. راجع المعلومات الموجودة في الصفحة الرئيسية.

## اختَر نموذجًا لبدء مشروع

يوفر *مشروع* الذكاء الاصطناعي في Azure مساحة عمل تعاونية لتطوير الذكاء الاصطناعي. لنبدأ باختيار النموذج الذي نريد العمل به وإنشاء مشروع لاستخدامه فيه.

> **ملاحظة**: يمكن أن تعتمد مشاريع AI Foundry على مورد *Azure AI Foundry*، والذي يوفر الوصول إلى نماذج الذكاء الاصطناعي (بما في ذلك Azure OpenAI)، وخدمات الذكاء الاصطناعي في Azure، والموارد الأخرى لتطوير وكلاء الذكاء الاصطناعي وحلول الدردشة. بدلًا من ذلك، يمكن أن تعتمد المشاريع على موارد *مركز الذكاء الاصطناعي*؛ والتي تتضمن اتصالات بموارد Azure للتخزين الآمن والحوسبة والأدوات المتخصصة. تُعد المشاريع المستندة إلى Azure AI Foundry رائعة للمطورين الذين يرغبون في إدارة الموارد لتطوير وكيل ذكاء اصطناعي أو تطبيق دردشة. تُعد المشاريع المعتمدة على مركز الذكاء الاصطناعي أكثر ملاءمة لفرق تطوير المؤسسات التي تعمل على حلول الذكاء الاصطناعي المعقدة.

1. في الصفحة الرئيسية، في قسم **استكشاف النماذج والإمكانات**، ابحث عن النموذج `Phi-4-multimodal-instruct`؛ الذي سنستخدمه في مشروعنا.

1. في نتائج البحث، حدّد نموذج **Phi-4-multimodal-instruct** لعرض تفاصيله، ثم في أعلى صفحة النموذج، حدّد **استخدام هذا النموذج**.

1. عند مطالبتك بإنشاء مشروع، أدخل اسمًا صالحًا لمشروعك ووسّع **الخيارات المتقدمة**.

1. حدد **تخصيص** وحدد الإعدادات التالية لمركزك:
    - **مورد Azure AI Foundry**: *اسم صالح لمورد Azure AI Foundry الخاص بك*
    - **Subscription**: *اشتراكك في Azure*
    - **Resource group**: *إنشاء مجموعة موارد أو تحديدها*
    - **المنطقة**: *حدد أيًّا من **ميزات AI Foundry الموصى بها***\*

    > \*تخضع بعض موارد الذكاء الاصطناعي في Azure لحصص النموذج الإقليمية. في حالة تجاوز مساحة القرص المتوفرة لاحقًا في التدريب، هناك احتمال أن تحتاج إلى إنشاء مورد آخر في منطقة مختلفة.

1. حدد **إنشاء** وانتظر حتى يتم إنشاء مشروعك، بما في ذلك توزيع النموذج Phi-4-multimodal-instruct الذي حددته.

    > ملاحظة: بناءً على اختيارك للنموذج، قد تتلقى مطالبات إضافية في أثناء عملية إنشاء المشروع. يُرجى قبول الشروط وإنهاء عملية التوزيع.

1. عند إنشاء مشروعك، سيظهر النموذج الخاص بك في صفحة **النماذج + نقاط النهاية**:

    ![لقطة شاشة لصفحة توزيع النموذج.](./media/ai-foundry-model-deployment.png)

## اختبر النموذج في مساحة التجربة

الآن يمكنك اختبار توزيع النموذج متعدد الوسائط الخاص بك باستخدام مطالبة تستند إلى صورة في مساحة اختبار الدردشة.

1. حدد **فتح في مساحة الاختبار** في صفحة توزيع النموذج.

1. في علامة تبويب المتصفح الجديدة، نزّل الملف [mango.jpeg](https://github.com/MicrosoftLearning/mslearn-ai-vision/raw/refs/heads/main/Labfiles/gen-ai-vision/mango.jpeg) من `https://github.com/MicrosoftLearning/mslearn-ai-vision/raw/refs/heads/main/Labfiles/gen-ai-vision/mango.jpeg` واحفظه في مجلد على نظام الملفات المحلي لديك.

1. في صفحة بيئة الدردشة، في جزء **الإعداد**، تأكد من تحديد توزيع نموذج **Phi-4-multimodal-instruct** الخاص بك.

1. في لوحة جلسة الدردشة الرئيسية، أسفل مربع إدخال الدردشة، استخدم زر الإرفاق (**&#128206;**) لتحميل ملف الصورة *mango.jpeg*، ثم أضف النص `What desserts could I make with this fruit?` وأرسل المطالبة.

    ![لقطة شاشة لصفحة مساحة اختبار الدردشة.](../media/chat-playground-image.png)

1. راجع الرد، والذي من المفترض أن يوفر لك إرشادات ذات صلة بالحلويات التي يمكنك صنعها باستخدام المانجو.

## أنشئ تطبيق عميل

الآن بعد أن نشرت النموذج، يمكنك استخدام النشر في تطبيق عميل.

### إعداد تكوين التطبيق

1. في مدخل مصنع الذكاء الاصطناعي في Azure، اعرض صفحة **النظرة العامة** لمشروعك.

1. في منطقة **نقاط النهاية والمفاتيح**، تأكد من تحديد مكتبة **Azure AI Foundry** ولاحظ **نقطة نهاية مشروع Azure AI Foundry**. ستستخدم سلسلة الاتصال هذه للاتصال بمشروعك في تطبيق العميل.

1. افتح علامة تبويب جديدة للمتصفح (مع إبقاء مدخل مصنع الذكاء الاصطناعي في Azure مفتوحًا في علامة التبويب الموجودة). بعد ذلك في علامة التبويب الجديدة، انتقل إلى [بوابة Azure](https://portal.azure.com) على `https://portal.azure.com`؛ وسجّل الدخول باستخدام بيانات اعتماد Azure الخاصة بك إذا طُلب منك ذلك.

    أغلق أي إشعارات ترحيبية لرؤية الصفحة الرئيسية لبوابة Azure.

1. استخدم الزر **[\>_]** الموجود على يمين شريط البحث أعلى الصفحة لإنشاء Cloud Shell جديد في بوابة Azure، وتحديد بيئة ***PowerShell*** بدون مساحة تخزين في اشتراكك.

    يوفّر Cloud Shell واجهة سطر الأوامر في الجزء الموجود في أسفل بوابة Azure. يمكنك تغيير حجم هذا الجزء أو تكبيره لتسهيل العمل فيه.

    > **ملاحظة**: إذا كنت قد أنشأت مسبقًا Cloud Shell يستخدم بيئة *معالج Bash*، فبدّل إلى ***PowerShell***.

    > **ملاحظة**: إذا طلب منك المدخل تحديد مساحة تخزين للاحتفاظ بملفاتك بشكل دائم، فاختَر **لا يلزم حساب تخزين**، وحدّد الاشتراك الذي تستخدمه ثم اضغط على **تطبيق**.

1. في شريط أدوات Cloud Shell، في قائمة **الإعدادات**، حدد **الانتقال إلى الإصدار الكلاسيكي** (هذا مطلوب لاستخدام محرر التعليمات البرمجية).

    **<font color="red">تأكد من التبديل إلى الإصدار الكلاسيكي من cloud shell قبل المتابعة.</font>**

1. في جزء Cloud Shell، أدخل الأوامر التالية لنسخ مخزن بيانات GitHub الخاص الذي يحتوي على ملفات التعليمات البرمجية لهذا التدريب (اكتب الأمر أو انسخه إلى الحافظة ثم انقر بزر الماوس الأيمن في سطر الأوامر والصقه كنص عادي):

    ```
    rm -r mslearn-ai-vision -f
    git clone https://github.com/MicrosoftLearning/mslearn-ai-vision
    ```

    > **تلميح**: عند لصق الأوامر في CloudShell، قد يشغل الإخراج مساحة كبيرة من ذاكرة التخزين المؤقت للشاشة. يمكنك مسح الشاشة عن طريق إدخال الأمر `cls` لتسهيل التركيز على كل مهمة.

1. بعد استنساخ مخزن بيانات خاصة، انتقل إلى المجلد الذي يحتوي على ملفات التعليمات البرمجية لتطبيق الدردشة:  

    ```
   cd mslearn-ai-vision/Labfiles/gen-ai-vision/python
    ```

1. في جزء سطر أوامر Cloud Shell، أدخل الأمر التالي لتثبيت المكتبات التي ستستخدمها:

    ```
   python -m venv labenv
   ./labenv/bin/Activate.ps1
   pip install -r requirements.txt azure-identity azure-ai-projects openai
    ```

1. أدخل الأمر التالي لتحرير ملف التكوين الذي تم توفيره:

    ```
   code .env
    ```

    يتم فتح الملف في محرر التعليمات البرمجية.

1. في ملف التعليمات البرمجية، استبدل العنصر النائب **your_project_endpoint** بنقطة نهاية مشروع Foundry (المنسوخة من صفحة **نظرة عامة** بالمشروع في مدخل Azure AI Foundry)، واستبدل العنصر النائب **your_model_deployment** بالاسم الذي قمت بتعيينه لتوزيع نموذجك Phi-4-multimodal-instruct.

1. بعد استبدال العناصر النائبة في محرر التعليمات البرمجية، استخدم الأمر **CTRL+S** أو **انقر زر الماوس الأيمن > حفظ** لحفظ التغييرات ثم استخدم الأمر **CTRL+Q** أو **انقر زر الماوس الأيمن > خروج** لإغلاق محرر التعليمات البرمجية مع إبقاء سطر أوامر Cloud Shell مفتوحًا.

### اكتب التعليمة البرمجية للاتصال بمشروعك والحصول على عميل دردشة لنموذجك

> **تلميح**: عند إضافة التعليمات البرمجية، تأكد من الحفاظ على المسافة البادئة الصحيحة.

1. أدخل الأمر التالي لتحرير ملف التعليمات البرمجية الذي تم توفيره:

    ```
   code chat-app.py
    ```

1. في ملف التعليمات البرمجية، لاحظ العبارات الموجودة في أعلى الملف والتي تمت إضافتها لاستيراد مساحات الأسماء (Namespaces) الضرورية لـ (SDK). بعد ذلك، ابحث عن التعليق **إضافة المراجع**، وأضف التعليمة البرمجية التالية للإشارة إلى المساحات الأساسية في المكتبات التي قمت بتثبيتها مسبقًا:

    ```python
   # Add references
   from azure.identity import DefaultAzureCredential
   from azure.ai.projects import AIProjectClient
   from openai import AzureOpenAI
    ```

1. في الوظيفة **الرئيسية**، تحت التعليق **الحصول على إعدادات التكوين**، لاحظ أن التعليمة البرمجية تقوم بتحميل قيم سلسلة الاتصال بالمشروع واسم نشر النموذج التي قمت بتحديدها في ملف التكوين.
1. في الوظيفة **الرئيسية**، تحت التعليق **الحصول على إعدادات التكوين**، لاحظ أن التعليمة البرمجية تقوم بتحميل قيم سلسلة الاتصال بالمشروع واسم نشر النموذج التي قمت بتحديدها في ملف التكوين.
1. ابحث عن التعليق **تهيئة عميل المشروع**، وأضِف التعليمة البرمجية التالية للاتصال بمشروع مصنع الذكاء الاصطناعي في Azure الخاص بك:

    > **تلميح**: كن حذرًا للحفاظ على مستوى المسافة البادئة الصحيح للتعليمات البرمجية الخاصة بك.

    ```python
   # Initialize the project client
   project_client = AIProjectClient(            
            credential=DefaultAzureCredential(
                exclude_environment_credential=True,
                exclude_managed_identity_credential=True
            ),
            endpoint=project_endpoint,
        )
    ```

1. ابحث عن التعليق **Get a chat client**، أضف التعليمة البرمجية التالية لإنشاء عنصر عميل للدردشة مع نموذج:

    ```python
   # Get a chat client
   openai_client = project_client.get_openai_client(api_version="2024-10-21")
    ```

### اكتب تعليمة برمجية لإرسال مطالبة صورة تعتمد على عنوان URL

1. لاحظ أن التعليمات البرمجية تتضمن تكرار حلقي للسماح للمستخدم بإدخال مطالبة حتى يدخل "إنهاء". بعد ذلك في قسم التكرار، ابحث عن التعليق **الحصول على رد لإدخال الصورة**، وأضف التعلية البرمجية التالية لإرسال مطالبة تتضمن الصورة التالية:

    ![صورة المانجو.](../media/orange.jpeg)

    ```python
   # Get a response to image input
   image_url = "https://github.com/MicrosoftLearning/mslearn-ai-vision/raw/refs/heads/main/Labfiles/gen-ai-vision/orange.jpeg"
   image_format = "jpeg"
   request = Request(image_url, headers={"User-Agent": "Mozilla/5.0"})
   image_data = base64.b64encode(urlopen(request).read()).decode("utf-8")
   data_url = f"data:image/{image_format};base64,{image_data}"

   response = openai_client.chat.completions.create(
        model=model_deployment,
        messages=[
            {"role": "system", "content": system_message},
            { "role": "user", "content": [  
                { "type": "text", "text": prompt},
                { "type": "image_url", "image_url": {"url": data_url}}
            ] } 
        ]
   )
   print(response.choices[0].message.content)
    ```

1. استخدم الأمر **CTRL+S** لحفظ التغييرات في ملف التعليمات البرمجية، لكن لا تغلقه بعد.

## سجّل الدخول إلى Azure وشغّل التطبيق

1. في جزء سطر أوامر Cloud Shell، أدخل الأمر التالي لتسجيل الدخول إلى Azure.

    ```
   az login
    ```

    **<font color="red">يجب عليك تسجيل الدخول إلى Azure - حتى لو تم بالفعل مصادقة جلسة Cloud Shell.</font>**

    > **ملاحظة**: في معظم السيناريوهات، سيكون استخدام *az login* كافيًا. ومع ذلك، إذا كان لديك اشتراكات لدى مستأجرين متعددين، فقد تحتاج إلى تحديد المستأجر باستخدام المعلمة *--tenant*. راجع [تسجيل الدخول إلى Azure بشكل تفاعلي باستخدام Azure CLI](https://learn.microsoft.com/cli/azure/authenticate-azure-cli-interactively) للحصول على التفاصيل.
    
1. عند مطالبتك بذلك، اتبع الإرشادات لفتح صفحة تسجيل الدخول في علامة تبويب جديدة وأدخل رمز المصادقة المقدم وبيانات اعتماد Azure الخاصة بك. ثم أكمل عملية تسجيل الدخول في سطر الأوامر، وحدد الاشتراك الذي يحتوي على مركز Azure AI Foundry الخاص بك إذا طُلب منك ذلك.

1. بعد تسجيل الدخول، أدخل الأمر التالي لتشغيل التطبيق:

    ```
   python chat-app.py
    ```

1. عند طلب بذلك، أدخل المطالبة التالية:

    ```
   Suggest some recipes that include this fruit
    ```

1. راجع الاستجابة. ثم أدخل `quit` للخروج من البرنامج.

### تعديل التعليمة البرمجية لتحميل ملف صورة محلي

1. في محرر التعليمات البرمجية الخاص بكود تطبيقك، في قسم التكرار، ابحث عن التعليمة البرمجية الذي أضفتها مسبقًا ضمن التعليق **الحصول على رد لإدخال الصورة**. ثم عدّل التعليمات البرمجية كما يلي، لتحميل ملف الصورة المحلي هذا:

    ![صورة لفاكهة التنين.](../media/mystery-fruit.jpeg)

    ```python
   # Get a response to image input
   script_dir = Path(__file__).parent  # Get the directory of the script
   image_path = script_dir / 'mystery-fruit.jpeg'
   mime_type = "image/jpeg"

   # Read and encode the image file
   with open(image_path, "rb") as image_file:
        base64_encoded_data = base64.b64encode(image_file.read()).decode('utf-8')

   # Include the image file data in the prompt
   data_url = f"data:{mime_type};base64,{base64_encoded_data}"
   response = openai_client.chat.completions.create(
            model=model_deployment,
            messages=[
                {"role": "system", "content": system_message},
                { "role": "user", "content": [  
                    { "type": "text", "text": prompt},
                    { "type": "image_url", "image_url": {"url": data_url}}
                ] } 
            ]
   )
   print(response.choices[0].message.content)
    ```

1. استخدم الأمر **CTRL+S** لحفظ التغييرات في ملف التعليمات البرمجية. يمكنك أيضًا إغلاق محرر التعليمات البرمجية باستخدام (**CTRL+Q**) إذا رغبت في ذلك.

1. في جزء سطر أوامر Cloud Shell أسفل محرر التعليمات البرمجية، أدخل الأمر التالي لتشغيل التطبيق:

    ```
   python chat-app.py
    ```

1. عند طلب بذلك، أدخل المطالبة التالية:

    ```
   What is this fruit? What recipes could I use it in?
    ```

15. راجع الاستجابة. ثم أدخل `quit` للخروج من البرنامج.

    > **ملاحظة**: في هذا التطبيق البسيط، لم ننفّذ منطق للاحتفاظ بسجل المحادثة؛ لذلك سيعامل النموذج كل مطالبة على أنها طلب جديد دون أي سياق للمطالبة السابقة.

## تنظيف

إذا انتهيت من استكشاف مدخل Azure AI Foundry، فيجب عليك حذف الموارد التي أنشأتها في هذا التدريب لتجنب تكبد تكاليف Azure غير الضرورية.

1. افتح [بوابة Azure](https://portal.azure.com) واعرض محتويات مجموعة الموارد التي نشرت الموارد المستخدمة في هذا التمرين فيها.
1. على شريط الأدوات، حدد **حذف مجموعة الموارد**.
1. أدخل اسم مجموعة الموارد وأكّد أنك تريد حذفها.

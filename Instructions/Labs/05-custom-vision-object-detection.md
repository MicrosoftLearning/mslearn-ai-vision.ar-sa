---
lab:
  title: كشف الكائنات في الصور
  description: استخدم خدمة Azure AI Custom Vision لتدريب نموذج للكشف عن الكائنات.
---

# كشف الكائنات في الصور

تمكنك خدمة **Azure AI Custom Vision** من إنشاء نماذج رؤية الكمبيوتر المدربة على صورك الخاصة. يمكنك استخدامه لتدريب *تصنيف الصور* ونماذج *الكشف عن الكائنات*؛ والتي يمكنك بعد ذلك نشرها واستهلاكها من التطبيقات.

في هذا التمرين، ستستخدم خدمة Custom Vision لتدريب *نموذج * الكشف عن العناصر الذي يمكنه اكتشاف وتحديد موقع ثلاث فئات من الفاكهة (التفاح والموز والبرتقال) في صورة.

يستند هذا التمرين إلى عدة تطوير البرامج (SDK) الخاصة بـ Azure Custom Vision للغة Python، لكن يمكنك تطوير تطبيقات الرؤية الحاسوبية باستخدام عِدد تطوير برامج (SDK) خاصة بلغات متعددة، منها:

* [Azure Custom Vision للغة JavaScript (التدريب)](https://www.npmjs.com/package/@azure/cognitiveservices-customvision-training)
* [Azure Custom Vision للغة JavaScript (التنبؤ)](https://www.npmjs.com/package/@azure/cognitiveservices-customvision-prediction)
* [Azure Custom Vision للغة Microsoft .NET (التدريب)](https://www.nuget.org/packages/Microsoft.Azure.CognitiveServices.Vision.CustomVision.Training/)
* [Azure Custom Vision للغة Microsoft .NET (التنبؤ)](https://www.nuget.org/packages/Microsoft.Azure.CognitiveServices.Vision.CustomVision.Prediction/)
* [Azure Custom Vision للغة Java (التدريب)](https://search.maven.org/artifact/com.azure/azure-cognitiveservices-customvision-training/1.1.0-preview.2/jar)
* [Azure Custom Vision للغة Java (التنبؤ)](https://search.maven.org/artifact/com.azure/azure-cognitiveservices-customvision-prediction/1.1.0-preview.2/jar)

يستغرق هذا التدريب حوالي **45** دقيقة.

## إنشاء موارد الرؤية المخصصة

قبل أن تتمكن من تدريب نموذج، ستحتاج إلى موارد Azure *للتدريب* و*التنبؤ*. يمكنك إنشاء موارد **Custom Vision** لكل مهمة، أو إنشاء مورد واحد لاستخدامه في المهمتين معًا. في هذا التمرين، ستنشئ موارد **Custom Vision** للتدريب والتنبؤ.

1. افتح [مدخل Microsoft Azure](https://portal.azure.com) عبر `https://portal.azure.com`، وسجِّل الدخول باستخدام بيانات اعتماد Azure الخاصة بك. أغلِق أي رسائل ترحيب أو تلميحات قد تظهر.
1. حدد **Create a resource.**
1. في شريط البحث، ابحث عن `Custom Vision`، وحدد **Custom Vision**، وأنشئ المورد باستخدام الإعدادات التالية:
    - **إنشاء خيارات**: كلاهما
    - **Subscription**: *اشتراكك في Azure*
    - **Resource group**: *إنشاء مجموعة موارد أو تحديدها*
    - **المنطقة**: *اختر أي منطقة متوفرة*
    - **الاسم**: *اسم صالح لمورد Custom Vision الخاص بك*
    - **مستوى أسعار التدريب:** F0
    - **مستوى أسعار التنبؤ**: F0

1. أنشئ المورد وانتظر حتى يكتمل التوزيع، ثم اعرض تفاصيل التوزيع. لاحظ أنه تم توفير موردين لـ Custom Vision: أحدهما للتدريب والآخر للتنبؤ.

    > **ملاحظة**: لكل مورد * نقطة نهاية *و*مفاتيح*خاصة به، والتي تستخدم لإدارة الوصول من التعليمات البرمجية الخاصة بك. لتدريب نموذج تصنيف الصور، يجب أن تستخدم التعليمات البرمجية لديك مورد * التدريب* (بنقطة النهاية والمفتاح الخاص بها)؛ ولاستخدام النموذج المدرب للتنبؤ بفئات الصور، يجب أن تستخدم التعليمات البرمجية لديك مورد* التنبؤ* (باستخدام نقطة النهاية والمفتاح الخاص بها).

1. بعد توزيع الموارد، انتقل إلى مجموعة الموارد لعرضها. يجب أن ترى موردَين لـ custom vision، أحدهما يحمل اللاحقة ***Prediction-***.

## إنشاء مشروع Custom Vision في مدخل Custom Vision

لتدريب نموذج اكتشاف العنصر، تحتاج إلى إنشاء مشروع رؤية مخصصة بناءً على مورد التدريب الخاص بك. للقيام بذلك، ستستخدم مدخل Custom Vision.

1. افتح علامة تبويب جديدة في المتصفح (مع ترك علامة تبويب مدخل Microsoft Azure مفتوحة، إذ ستعود إليها لاحقًا).
1. في علامة التبويب الجديدة في المتصفح، افتح [مدخل Custom Vision](https://customvision.ai) عبر `https://customvision.ai`. إذا طُلب منك ذلك، فسجِّل الدخول باستخدام بيانات اعتماد Azure الخاصة بك ووافق على شروط الخدمة.
1. إنشاء مشروع جديد بالإعدادات التالية:
    - **الاسم:** `Detect Fruit`
    - **الوصف**: `Object detection for fruit.`
    - **المورد**: *مورد Custom Vision الخاص بك*
    - **أنواع المشروع**: الكشف عن الكائنات
    - **النطاقات**: عام
1. انتظر المشروع إلى إنشاء وفتح في المستعرض.

## تحميل الصور ووضع علامات عليها

لديك الآن مشروع الكشف عن الكائنات، ويمكنك تحميل الصور ووضع علامات عليها لتدريب نموذج.

### تحميل الصور ووضع علامة عليها في مدخل Custom Vision

يتضمن مدخل Custom Vision أدوات مرئية يمكنك استخدامها لتحميل الصور ووضع علامات على المناطق داخلها التي تحتوي على أنواع متعددة من الكائنات.

1. في علامة تبويب جديدة في المتصفح، نزِّل [صور التدريب](https://github.com/MicrosoftLearning/mslearn-ai-vision/raw/main/Labfiles/object-detection/training-images.zip) من `https://github.com/MicrosoftLearning/mslearn-ai-vision/raw/main/Labfiles/object-detection/training-images.zip` واستخرج المجلد المضغوط لعرض محتوياته. يحتوي هذا المجلد على صور للفاكهة.
1. في منصة الرؤية المعدلة في مشروع الكشف عن الأشياء، اختر **إضافة الصور** وحمل جميع الصور من الملف المستخرج.
1. بعد تحميل الصور، حدد أول صورة تفتحها.
1. ضع الماوس فوق أي كائن في الصورة حتى يتم عرض المنطقة المكتشفة تلقائيًا مثل الصورة أدناه. ثم حدد الكائن، وإذا لزم الأمر، قم بتغيير حجم المنطقة المحيطة به.

    ![لقطة شاشة للمنطقة الافتراضية لكائن ما.](../media/object-region.jpg)

    بدلاً من ذلك، يمكنك ببساطة السحب حول الكائن لإنشاء منطقة.

1. عندما تحيط المنطقة بالكائن، أضف علامة جديدة بنوع الكائن المناسب (*التفاح* أو *الموز* أو *البرتقال*) كما هو موضح هنا:

    ![لقطة شاشة لكائن تم وضع علامة عليه في صورة.](../media/object-tag.jpg)

1. حدد كل كائن آخر في الصورة وقم بتمييزه، وقم بتغيير حجم المناطق وإضافة علامات جديدة حسب الحاجة.

    ![لقطة شاشة لكائنين تم وضع علامة على كلٍّ منهما في الصورة نفسها.](../media/object-tags.jpg)

1. استخدم الرابط **>** الموجود على اليمين للانتقال إلى الصورة التالية، ووضع علامة على كائناتها. ثم استمر في العمل من خلال مجموعة الصور بأكملها، ووضع علامات على كل تفاحة وموز وبرتقال.

1. عند الانتهاء من وضع علامات على الصورة الأخيرة، أغلق محرر ** تفاصيل الصورة**. في صفحة **تدريب الصور**، ضمن **العلامات**، حدد **الصور ذات العلامات** لمشاهدة جميع الصور ذات العلامات:

![لقطة شاشة لصور بها علامات في مشروع.](../media/tagged-images.jpg)

### استخدام عدة تطوير برامج الرؤية المخصصة لتحميل الصور

يمكنك استخدام UI في بوابة الرؤية المخصصة لوضع علامة على صورك، ولكن العديد من فرق التطوير الذكاء الاصطناعي تستخدم أدوات أخرى تنشئ ملفات تحتوي على معلومات حول العلامات ومناطق العناصر في الصور. في سيناريوهات مثل هذه، يمكنك استخدام واجهة برمجة تطبيقات تدريب Custom Vision لتحميل الصور ذات العلامات إلى المشروع.

1. انقر فوق أيقونة *الإعدادات* (#9881;) في الجزء العلوي الأيمن من صفحة**صور التدريب** في مدخل Custom Vision لعرض إعدادات المشروع.
1. ضمن **عام** (على اليسار)، لاحظ **معرف المشروع** لذي يعرف هذا المشروع بشكل فريد.
1. على اليمين، ضمن **الموارد** لاحظ أنه يتم عرض **المفتاح** و**نقطة النهاية**. هذه هي تفاصيل مورد * التدريب* (يمكنك أيضًا الحصول على هذه المعلومات عن طريق عرض المورد في مدخل Microsoft Azure).
1. عُد إلى علامة تبويب المتصفح التي تحتوي على مدخل Microsoft Azure (مع ترك علامة تبويب مدخل Custom Vision مفتوحة، إذ ستعود إليها لاحقًا).
1. في مدخل Microsoft Azure، استخدم الزر **[\>_]** الموجود على يمين شريط البحث في أعلى الصفحة لإنشاء جلسة جديدة من Cloud Shell في مدخل Microsoft Azure، وحدد بيئة ***PowerShell*** دون مساحة تخزين في اشتراكك.

    يوفّر Cloud Shell واجهة سطر الأوامر في الجزء الموجود في أسفل بوابة Azure.

    > **ملاحظة**: إذا كنت قد أنشأت مسبقًا Cloud Shell يستخدم بيئة *معالج Bash*، فبدّل إلى ***PowerShell***.

    > **ملاحظة**: إذا طلب منك المدخل تحديد مساحة تخزين للاحتفاظ بملفاتك بشكل دائم، فاختَر **لا يلزم حساب تخزين**، وحدّد الاشتراك الذي تستخدمه ثم اضغط على **تطبيق**.

1. في شريط أدوات Cloud Shell، في قائمة **الإعدادات**، حدد **الانتقال إلى الإصدار الكلاسيكي** (هذا مطلوب لاستخدام محرر التعليمات البرمجية).

    **<font color="red">تأكد من التبديل إلى الإصدار الكلاسيكي من cloud shell قبل المتابعة.</font>**

1. غيِّر حجم جزء cloud shell لعرض مساحة أكبر منه.

    > **تلميح**" يمكنك تغيير حجم الجزء عن طريق سحب الحد العلوي. يمكنك أيضًا استخدام زرَّي التصغير والتكبير للتبديل بين cloud shell والواجهة الرئيسية للمدخل.

1. في جزء Cloud Shell، أدخل الأوامر التالية لنسخ مخزن بيانات GitHub الخاص الذي يحتوي على ملفات التعليمات البرمجية لهذا التدريب (اكتب الأمر أو انسخه إلى الحافظة ثم انقر بزر الماوس الأيمن في سطر الأوامر والصقه كنص عادي):

    ```
    rm -r mslearn-ai-vision -f
    git clone https://github.com/MicrosoftLearning/mslearn-ai-vision
    ```

    > **تلميح**: عند لصق الأوامر في CloudShell، قد يشغل الإخراج مساحة كبيرة من ذاكرة التخزين المؤقت للشاشة. يمكنك مسح الشاشة عن طريق إدخال الأمر `cls` لتسهيل التركيز على كل مهمة.

1. بعد نسخ المستودع، استخدم الأمر التالي للانتقال إلى ملفات التعليمات البرمجية للتطبيق:

    ```
   cd mslearn-ai-vision/Labfiles/object-detection/python/train-detector
   ls -a -l
    ```

    يحتوي المجلد على تكوين التطبيق وملفات التعليمات البرمجية له. كما يتضمن الملف **tagged-images.json**، والذي يحتوي على إحداثيات مربع إحاطة للكائنات في صور متعددة، والمجلد الفرعي **images/** الذي يحتوي على الصور.

1. ثبِّت حزمة عدة تطوير البرامج (SDK) الخاصة بـ Azure AI Custom Vision للتدريب وأي حزم أخرى مطلوبة بتشغيل الأوامر التالية:

    ```
   python -m venv labenv
   ./labenv/bin/Activate.ps1
   pip install -r requirements.txt azure-cognitiveservices-vision-customvision
    ```

1. أدخِل الأمر التالي لتحرير ملف التكوين الخاص بتطبيقك:

    ```
   code .env
    ```

    يتم فتح الملف في محرر التعليمات البرمجية.

1. في ملف التعليمات البرمجية، حدِّث قيم التكوين التي يحتوي عليها لتعكس **نقطة النهاية** و**مفتاح** مصادقة لمورد *تدريب* Custom Vision الخاص بك، بالإضافة إلى **معرّف المشروع** لمشروع custom vision الذي أنشأته مسبقًا.
1. بعد استبدال العناصر النائبة في محرر التعليمات البرمجية، استخدم الأمر **CTRL+S** لحفظ التغييرات ثم استخدم الأمر **CTRL+Q** لإغلاق محرر التعليمات البرمجية مع إبقاء سطر أوامر Cloud Shell مفتوحًا.
1. في سطر أوامر cloud shell، أدخِل الأمر التالي لفتح الملف **tagged-images.json** والاطّلاع على معلومات وضع العلامات لملفات الصور في المجلد الفرعي **images/**:

    ```
   code tagged-images.json
    ```
    
     تمثل صيغة JSON قائمة بالصور، تحتوي كل صورة على منطقة واحدة أو أكثر تمت إضافة علامات إليها. تتضمن كل منطقة ذات علامة اسم علامة، والإحداثيات العلوية واليسرى وأبعاد العرض والارتفاع لمربع الإحاطة الذي يحتوي على الكائن ذي علامة.

    > **ملاحظة**: تشير الإحداثيات والأبعاد في هذا الملف إلى نقاط نسبية على الصورة. على سبيل المثال، تشير قيمة* الارتفاع* 0.7 إلى مربع يمثل 70% من ارتفاع الصورة. تنشئ بعض أدوات وضع العلامات تنسيقات أخرى من الملفات حيث تمثل قيم الإحداثيات والأبعاد وحدات البكسل أو البوصة أو وحدات القياس الأخرى.

1. أغلِق ملف JSON دون حفظ أي تغييرات (*CTRL_Q*).

1. في سطر أوامر cloud shell، أدخِل الأمر التالي لفتح ملف التعليمات البرمجية لتطبيق العميل:

    ```
   code add-tagged-images.py
    ```

1. لاحظ التفاصيل التالية في ملف التعليمات البرمجية:
    - تم استيراد مساحات الأسماء لعدة تطوير البرامج (SDK) الخاصة بـ Azure AI Custom Vision.
    - تسترد الدالة ** Main** إعدادات التكوين، وتستخدم المفتاح ونقطة النهاية لإنشاء **CustomVisionTrainingClient** مصدق عليه، والذي يتم استخدامه بعد ذلك مع معرف المشروع لإنشاء مرجع** مشروع** إلى مشروعك.
    - تستخرج الدالة ** Upload_Images** معلومات المنطقة ذات العلامات من ملف JSON وتستخدمها لإنشاء مجموعة من الصور مع المناطق، والتي تقوم بتحميلها بعد ذلك إلى المشروع.

1. أغلِق محرر التعليمات البرمجية (*CTRL+Q*) وأدخِل الأمر التالي لتشغيل البرنامج:

    ```
   python add-tagged-images.py
    ```

1. انتظر حتى ينتهي البرنامج.
1. عُد مرة أخرى إلى علامة تبويب المتصفح التي تحتوي على مدخل Custom Vision (مع ترك علامة تبويب cloud shell ضمن مدخل Microsoft Azure مفتوحة)، واعرض صفحة **صور التدريب** الخاصة بمشروعك (مع تحديث المتصفح إذا لزم الأمر).
1. تحقق من إضافة بعض الصور ذات العلامات الجديدة إلى المشروع.

## تدريب واختبار نموذج

الآن بعد أن قمت بتمييز الصور في مشروعك، فأنت جاهز لتدريب نموذج.

1. في مشروع Custom Vision، انقر على **تدريب** (&#9881;<sub>&#9881;</sub>) لتدريب نموذج الكشف عن الكائنات باستخدام الصور المضاف إليها علامات. حدد خيار **Quick Training**
1. انتظر حتى يكتمل التدريب (قد يستغرق حوالي عشر دقائق).

    > **تلميح**: تغلق جلسة Azure cloud shell تلقائيًا بعد 20 دقيقة من عدم النشاط. خلال انتظار انتهاء التدريب، افتح Cloud Shell من وقت لآخر وأدخِل أمرًا مثل `ls` للحفاظ على نشاط الجلسة.

1. في مدخل Custom Vision، عند انتهاء التدريب، راجع مقاييس الأداء: *الدقة*و*الاسترجاع*و*متوسط الدقة (mAP)*. تحدد هذه المقاييس دقة تنبؤ نموذج الكشف عن الكائنات، ويجب أن تكون جميعها مرتفعة.
1. في أعلى يمين الصفحة، انقر على **اختبار سريع**، ثم مربع **عنوان URL الخاص بالصورة**، اكتب `https://aka.ms/test-fruit` وانقر على زر *صورة الاختبار السريع* (&#10132;).
1. اعرض التنبؤ الذي تم إنشاؤه.

    ![لقطة شاشة لاختبار الكشف عن الكائنات](../media/test-object-detection.png)

1. أغلق نافذة **اختبار سريع**.

## استخدام كاشف الكائنات في تطبيق عميل

أنت الآن جاهز لنشر نموذجك المُدرَّب واستخدامه في تطبيق عميل.

### نشر نموذج الكشف عن الكائنات

1. في مدخل Custom Vision، في صفحة **الأداء**، انقر فوق **&#128504; نشر** لنشر النموذج المُدرب بالإعدادات التالية:
    - **اسم النموذج**: `fruit-detector`
    - **مورد التنبؤ**: *مورد **التنبؤ** الذي أنشأته سابقًا والذي ينتهي بـ "-Prediction" (<u>ليس هو</u> مورد التدريب)*.
1. في الجزء العلوي الأيسر من صفحة **إعدادات المشروع**، انقر فوق أيقونة *معرض المشاريع* (&#128065;) للعودة إلى الصفحة الرئيسية لمدخل Custom Vision، حيث يتم إدراج مشروعك الآن.
1. في الصفحة الرئيسية لمدخل Custom Vision، في أعلى اليمين، انقر فوق أيقونة *الإعدادات * (&#9881;) لعرض إعدادات خدمة Custom Vision الخاصة بك. ثم، ضمن **الموارد**، ابحث عن مورد * التنبؤ *الذي ينتهي بـ "-Prediction" (<u>وليس</u> مورد التدريب) لتحديد قيم ** المفتاح **** ونقطة النهاية الخاصة به **(يمكنك أيضًا الحصول على هذه المعلومات عن طريق عرض المورد في مدخل Microsoft Azure).

## استخدام مصنف الصور من تطبيق عميل

الآن بعد أن قمت بنشر نموذج تصنيف الصور، يمكنك استخدامه من تطبيق عميل. مرة أخرى، يمكنك اختيار استخدام **C#** أو **Python**.

1. عُد إلى علامة تبويب المتصفح التي تحتوي على مدخل Microsoft Azure وجزء cloud shell.
1. في cloud shell، شغِّل الأوامر التالية للانتقال إلى مجلد تطبيق العميل وعرض الملفات التي يتضمنها:

    ```
   cd ../test-detector
   ls -a -l
    ```

    يحتوي المجلد على تكوين التطبيق وملفات التعليمات البرمجية له. كما يتضمن أيضًا ملف الصورة التالي **produce.jpg**، والذي ستستخدمه لاختبار النموذج.

    ![صورة لبعض الفواكه.](../media/produce.jpg)

1. ثبِّت حزمة عدة تطوير البرامج (SDK) الخاصة بـ Azure AI Custom Vision للتنبؤ وأي حزم أخرى مطلوبة بتشغيل الأوامر التالية:

    ```
   python -m venv labenv
   ./labenv/bin/Activate.ps1
   pip install -r requirements.txt azure-cognitiveservices-vision-customvision
    ```

1. أدخِل الأمر التالي لتحرير ملف التكوين الخاص بتطبيقك:

    ```
   code .env
    ```

    يتم فتح الملف في محرر التعليمات البرمجية.

1. حدِّث قيم التكوين لتعكس **نقطة النهاية** و**المفتاح** لمورد *<u>تنبؤ</u>* Custom Vision الخاص بك، و**معرّف المشروع** لمشروع الكشف عن الكائنات، واسم النموذج المتاح للنشر (ويُفترض أن يكون *fruit-detector*). احفظ التغييرات (*CTRL+S*) وأغلِق محرر التعليمات البرمجية (*CTRL+Q*).

1. في سطر أوامر cloud shell، أدخِل الأمر التالي لفتح ملف التعليمات البرمجية لتطبيق العميل:

    ```
   code test-detector.py
    ```

1. راجع التعليمات البرمجية، مع ملاحظة التفاصيل التالية:
    - تم استيراد مساحات الأسماء لعدة تطوير البرامج (SDK) الخاصة بـ Azure AI Custom Vision.
    - تسترد الدالة ** Main** إعدادات التكوين، وتستخدم المفتاح ونقطة النهاية لإنشاء **CustomVisionPredictionClient** مصدّق عليه.
    - يتم استخدام عنصر عميل التنبؤ للحصول على تنبؤات الكشف عن العناصر للصورة **produce.jpg**، مع تحديد معرف المشروع واسم النموذج في الطلب. ثم يتم رسم المناطق ذات العلامات المتوقعة على الصورة، وتُحفظ النتيجة على أنها **output.jpg**.
1. أغلِق محرر التعليمات البرمجية وأدخِل الأمر التالي لتشغيل البرنامج:

    ```
   python test-detector.py
    ```

1. راجع ناتج البرنامج، والذي يدرج كل كائن مكتشف في الصورة.
1. لاحظ أنه تم إنشاء ملف صورة باسم **output.jpg**. استخدم أمر **تنزيل** (المخصص لـ Azure cloud shell) لتنزيل ملف الصورة:

    ```
   download output.jpg
    ```

    ينشئ أمر التنزيل رابطًا منبثقًا في أسفل يمين متصفحك، والذي يمكنك تحديده لتنزيل الملف وفتحه. يجب أن تبدو الصورة مشابهة لما يلي:

    ![صورة تُميَّز فيها الكائنات المكتشفة.](../media/object-detection-output.jpg )

## تنظيف الموارد

إذا كنت لا تستخدم موارد Azure التي أنشأتها في هذا المختبر لوحدات التدريب الأخرى، فيمكنك حذفها لتجنب تكبد المزيد من الرسوم.

1. افتح مدخل Azure في `https://portal.azure.com`، وفي شريط البحث العلوي، ابحث عن الموارد التي أنشأتها في هذا المختبر.

1. في صفحة المورد، حدد **حذف** واتبع الإرشادات لحذف المورد. بدلاً من ذلك، يمكنك حذف مجموعة الموارد بأكملها لتنظيف جميع الموارد في الوقت نفسه.
   
## مزيد من المعلومات

لمزيد من المعلومات حول الكشف عن العناصر باستخدام خدمة Custom Vision، راجع وثائق [Custom Vision](https://docs.microsoft.com/azure/cognitive-services/custom-vision-service/).
